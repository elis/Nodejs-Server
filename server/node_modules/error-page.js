var _ = require('underscore'),
	Errors;

/*                                            888888ba                             
											  88    `8b                            
.d8888b. 88d888b. 88d888b. .d8888b. 88d888b. a88aaaa8P' .d8888b. .d8888b. .d8888b. 
88ooood8 88'  `88 88'  `88 88'  `88 88'  `88  88        88'  `88 88'  `88 88ooood8 
88.  ... 88       88       88.  .88 88        88        88.  .88 88.  .88 88.  ... 
`88888P' dP       dP       `88888P' dP        dP        `88888P8 `8888P88 `88888P' 
																	  .88          
																  d8888P           
Generate Error Page
	@param {int, stirng} error code - see misc/errors.js
	@param {http.ServerRequest}
	@param {http.ServerResponse}
*/
var c = 0;
var errorPage = function (errorCode, req, res, extra, toConsole) {
	if (errorCode == 500 && serverConf.devMode)
		errorCode = 500.1;
		
	var error = Errors[errorCode] || error[500],
		data = _.isFunction(error.data) ? error.data(errorCode, error, req, extra) : error.data || '';
		
	if (toConsole) {
		console.log('\n\n^^^^^^^^^^^^^^^^^^ ERROR ^^^^^^^^^^^^^^^^^^');
		Util.log('Error page issue: ' + errorCode);
		console.log(error.reasonPhrase);
		if (extra)
			console.log(extra);
		
		console.log('___________________________________________\n');
	}
	if (req && res && !req.ended && !req.closed && !toConsole) {
		console.log(errorCode, ++c);
		res.writeHead(errorCode, error.reasonPhrase, error.headers);
		res.end(data);
	}
};

module.exports = {};
module.exports.setErrors = function (errorsObj) {
	Errors = errorsObj;
	return errorPage;
}
module.exports.errorPage = errorPage;